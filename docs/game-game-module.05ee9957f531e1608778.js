(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"57I3":function(t,e,c){"use strict";c.r(e),c.d(e,"GameModule",(function(){return q}));var s=c("An66"),a=c("1VvW"),i=c("aDqW"),n=c("bwdy"),r=c("kZht"),o=c("3p4X"),h=c("J+dc"),l=c("+6xv");const d=Object(l.m)("flipAnimation",[Object(l.j)("0",Object(l.k)({opacity:"1",transform:"rotateY(0deg)"})),Object(l.j)("1",Object(l.k)({opacity:"1",transform:"rotateY(180deg)"})),Object(l.j)("2",Object(l.k)({opacity:"0",transform:"rotateY(0deg)"})),Object(l.j)("3",Object(l.k)({opacity:"1",transform:"rotateY(180deg)"})),Object(l.j)("4",Object(l.k)({opacity:"0",transform:"rotateY(180deg)"})),Object(l.l)("1 => 4",[Object(l.k)({transform:"rotateY(0deg)",opacity:"1"}),Object(l.e)("250ms",Object(l.g)([Object(l.k)({transform:"rotateY(0deg)",opacity:"1"}),Object(l.k)({transform:"rotateY(0deg)",opacity:"0"})]))])]);var b=c("mcff"),u=c("hCLc");function p(t,e){if(1&t&&(r.Rb(0,"span"),r.vc(1),r.bc(2,"number"),r.Qb()),2&t){const t=r.ac();r.Ab(1),r.xc(" ",r.dc(2,1,t.data.complete.hours,"2.0",t.translate.currentLang)," hr ")}}function m(t,e){if(1&t&&(r.Rb(0,"span"),r.vc(1),r.bc(2,"number"),r.Qb()),2&t){const t=r.ac();r.Ab(1),r.xc(" ",r.dc(2,1,t.data.complete.minutes,"2.0",t.translate.currentLang)," min ")}}function g(t,e){if(1&t&&(r.Rb(0,"span"),r.vc(1),r.bc(2,"number"),r.Qb()),2&t){const t=r.ac();r.Ab(1),r.xc(" ",r.dc(2,1,t.data.complete.seconds,"2.0",t.translate.currentLang)," sec ")}}function f(t,e){if(1&t&&(r.Rb(0,"span"),r.vc(1),r.bc(2,"number"),r.Qb()),2&t){const t=r.ac();r.Ab(1),r.xc(" ",r.dc(2,1,t.data.complete.milliseconds,"3.0",t.translate.currentLang)," ms ")}}let v=(()=>{class t{constructor(t,e){this.data=t,this.translate=e}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(b.a),r.Lb(i.e))},t.\u0275cmp=r.Fb({type:t,selectors:[["app-game-end"]],decls:29,vars:28,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","","color","primary","type","button",3,"mat-dialog-close"]],template:function(t,e){1&t&&(r.Rb(0,"h1",0),r.vc(1),r.bc(2,"translate"),r.Qb(),r.Rb(3,"div",1),r.Rb(4,"p"),r.vc(5),r.bc(6,"translate"),r.bc(7,"translate"),r.Qb(),r.Rb(8,"p"),r.Rb(9,"b"),r.vc(10),r.bc(11,"translate"),r.Qb(),r.vc(12,": "),r.Rb(13,"span"),r.vc(14),r.bc(15,"number"),r.Qb(),r.Qb(),r.Rb(16,"p"),r.Rb(17,"b"),r.vc(18),r.bc(19,"translate"),r.Qb(),r.vc(20,": "),r.uc(21,p,3,5,"span",2),r.uc(22,m,3,5,"span",2),r.uc(23,g,3,5,"span",2),r.uc(24,f,3,5,"span",2),r.Qb(),r.Qb(),r.Rb(25,"div",3),r.Rb(26,"button",4),r.vc(27),r.bc(28,"translate"),r.Qb(),r.Qb()),2&t&&(r.Ab(1),r.xc("\ud83c\udf89 ",r.cc(2,12,"YOU_WON")," \ud83c\udf89"),r.Ab(4),r.yc(" ",r.cc(6,14,"YOUR_RESULTS_FOR_THIS_GAME"),"",r.cc(7,16,"FULL_STOP")," "),r.Ab(5),r.wc(r.cc(11,18,"FLIPS")),r.Ab(4),r.wc(r.dc(15,20,e.data.flips,"1.0",e.translate.currentLang)),r.Ab(4),r.wc(r.cc(19,24,"TIME")),r.Ab(3),r.gc("ngIf",e.data.complete.hours),r.Ab(1),r.gc("ngIf",e.data.complete.minutes||e.data.complete.hours),r.Ab(1),r.gc("ngIf",e.data.complete.seconds||e.data.complete.minutes||e.data.complete.hours),r.Ab(1),r.gc("ngIf",e.data.complete.milliseconds||e.data.complete.seconds||e.data.complete.minutes||e.data.complete.hours),r.Ab(2),r.gc("mat-dialog-close","reset"),r.Ab(1),r.xc(" ",r.cc(28,26,"RESET")," "))},directives:[b.g,b.e,s.l,b.c,u.b,b.d],pipes:[i.d,s.e],styles:[""],changeDetection:0}),t})();var k=c("WeD5"),y=c("7aFw"),w=c("Tybq"),O=c("W9YF"),S=c("5Rl/");let R=(()=>{class t{constructor(t,e,c,s){this.changeDetectorRef=t,this.device=e,this.game=c,this.translate=s}clear(){this.milliseconds=0,this.seconds=0,this.minutes=0,this.hours=0,this.changeDetectorRef.markForCheck()}clockRunning(){let t,e;this.timeBegan||(this.timeBegan=new Date),t=new Date,e=new Date(t.getTime()-this.timeBegan.getTime()),this.hours=e.getUTCHours(),this.minutes=e.getUTCMinutes(),this.seconds=e.getUTCSeconds(),this.milliseconds=e.getUTCMilliseconds(),23===this.hours&&59===this.minutes&&58===this.seconds&&this.milliseconds>=900&&this.stop(),this.changeDetectorRef.markForCheck()}continue(){if(this.active)return;let t,e,c;this.unsubscribe(),this.active=!0,t=new Date,c=new w.a(this.milliseconds,this.seconds,this.minutes,this.hours),e=Object(y.a)(c),this.timeBegan=new Date(t.getTime()-e),this.timer=Object(o.a)(10).subscribe(t=>{this.clockRunning()})}ngOnDestroy(){this.unsubscribe(),this.focusBlur&&this.focusBlur instanceof n.a&&this.focusBlur.unsubscribe()}ngOnInit(){this.focusBlur=this.device.active.subscribe(t=>{t?t&&this.game.playing.value&&this.continue():this.stop()})}reset(){this.stop(),this.clear()}restart(){this.reset(),this.continue()}stop(){this.active&&(this.active=!1,this.clockRunning(),this.unsubscribe())}unsubscribe(){this.timer&&this.timer instanceof n.a&&this.timer.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(r.h),r.Lb(O.a),r.Lb(S.a),r.Lb(i.e))},t.\u0275cmp=r.Fb({type:t,selectors:[["app-stopwatch"]],decls:7,vars:23,template:function(t,e){1&t&&(r.Rb(0,"span"),r.vc(1),r.bc(2,"translate"),r.bc(3,"number"),r.bc(4,"number"),r.bc(5,"number"),r.bc(6,"number"),r.Qb()),2&t&&(r.Ab(1),r.Bc(" ",r.cc(2,5,"TIME"),": ",r.dc(3,7,e.hours,"2.0",e.translate.currentLang)," : ",r.dc(4,11,e.minutes,"2.0",e.translate.currentLang)," : ",r.dc(5,15,e.seconds,"2.0",e.translate.currentLang)," : ",r.dc(6,19,e.milliseconds,"3.0",e.translate.currentLang),"\n"))},pipes:[i.d,s.e],styles:[""],changeDetection:0}),t})();var C=c("Po3z"),j=c("KfPq"),L=c("Asjx"),M=c("R/CI"),F=c("zE+5");let A=(()=>{class t{constructor(t,e){this.highScoresService=t,this.recentScoresService=e}get highScores(){return this.highScoresService.scores}get recentScores(){return this.recentScoresService.scores}addHighScoreStatistic(t){t=new k.a(t),this.highScoresService.add(t).then(t=>{this.ensureScoresLength("highScores")})}ensureScoresLength(t){let e;e={gameTypes:[],statistics:[]},e=this[t].reduce((e,c)=>{let s;if(s=`${c.mode}_${c.match}_${c.count}`,!e.gameTypes.includes(s)){let a;a=this[t+"Service"].getScoresBy(c.count,c.match,c.mode),"recentScores"!==t&&(a=this[t+"Service"].sort(a)),e.gameTypes.push(s),e.statistics.push(a)}return e},e),e.statistics.forEach(e=>{this.ensureGroupLength(e,t)})}ensureGroupLength(t,e){if(t.length>10){let c;c=t.pop().keyID,this[e+"Service"].delete(c).then(s=>{let a;a=this[e].findIndex(t=>t.keyID===c),-1!==a&&this[e].splice(a,1),t.length>10&&this.ensureGroupLength(t,e)}).catch(t=>{console.error(t.message)})}}addRecentScoreStatistic(t){t=new k.a(t),this.recentScoresService.add(t).then(t=>{this.ensureScoresLength("recentScores")})}addStatistic(t,e,c,s,a,i,n,r,o,h,l,d,b){let u;u="string"==typeof t&&"number"==typeof a?Object(C.a)(b)?new k.a(t,e,c,s,a,i,n,r,o,h,l,d):new k.a(t,e,c,s,a,i,n,r,o,h,l,d,b):"string"==typeof t&&"object"==typeof a?Object(C.a)(n)?new k.a(t,e,c,s,a,i):new k.a(t,e,c,s,a,i,n):t instanceof k.a?t:new k.a(t),this.addHighScoreStatistic(u),this.addRecentScoreStatistic(u)}clearStatistics(){this.highScoresService.clear(),this.recentScoresService.clear()}}return t.\u0275fac=function(e){return new(e||t)(r.Vb(M.a),r.Vb(F.a))},t.\u0275prov=r.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var I=c("ftHn"),Q=c("bX2N"),x=c("5LA1"),D=c("F6wS"),P=c("sH2/");function E(t,e){if(1&t){const t=r.Sb();r.Rb(0,"button",4),r.Yb("click",(function(){return r.mc(t),r.ac().profiler.profile()})),r.vc(1),r.bc(2,"translate"),r.Qb()}2&t&&(r.Ab(1),r.xc(" ",r.cc(2,1,"PROFILE")," "))}function T(t,e){1&t&&r.Mb(0,"mat-grid-tile")}const _=function(t,e,c){return{"f-0-t-1":t,"f-3-t-0":e,"f-4-t-0":c}};function B(t,e){if(1&t){const t=r.Sb();r.Pb(0),r.uc(1,T,1,0,"mat-grid-tile",7),r.Rb(2,"mat-grid-tile"),r.Rb(3,"div",8),r.Yb("click",(function(c){r.mc(t);const s=e.index;return r.ac(2).flipCard(c,s)})),r.Rb(4,"div",9),r.Mb(5,"img",10),r.Mb(6,"img",11),r.Qb(),r.Qb(),r.Qb(),r.Ob()}if(2&t){const t=e.$implicit,c=e.index,s=r.ac(2);r.Ab(1),r.gc("ngIf",18===s.cards.deck.length&&(15===c&&5===s.columns||16===c&&4===s.columns)),r.Ab(1),r.rc("margin-left",8!==s.cards.deck.length||6!==c&&7!==c?null:"calc(16.6666% + 2.5px)"),r.Ab(2),r.gc("@flipAnimation",t.flipped)("ngClass",r.jc(8,_,1===t.flipped,3===t.flipped,4===t.flipped)),r.Ab(1),r.Bb("src",s.cards.getCardImage(t),r.nc)("aria-label",0===t.flipped?"blank":t.name),r.Ab(1),r.Bb("src",s.cards.getCardBack(t),r.nc)}}function Y(t,e){if(1&t&&(r.Rb(0,"mat-card",0),r.Rb(1,"mat-card-content"),r.Rb(2,"mat-grid-list",5),r.uc(3,B,7,12,"ng-container",6),r.Qb(),r.Qb(),r.Qb()),2&t){const t=r.ac();r.Ab(2),r.gc("cols",t.columns),r.Ab(1),r.gc("ngForOf",t.cards.deck)("ngForTrackBy",t.trackBy)}}let V=(()=>{class t{constructor(t,e,c,s,a,i,n,r,o,h){this.platformId=t,this.changeDetectorRef=e,this.matDialog=c,this.mediaMatcher=s,this.statistics=a,this.cards=i,this.game=n,this.profiler=r,this.settings=o,this.translate=h}get effectsVolume(){return this.game.masterVolume.value*this.game.effectsVolume.value}get columns(){let t,e,c;switch(t=this.cards.deck.length,t){case 24:c={is:6,not:4};break;case 18:c={is:5,not:4};break;case 16:c={is:4,not:4};break;case 12:c={is:4,not:3};break;case 8:c={is:3,not:3};break;case 6:c={is:3,not:2};break;case 4:default:c={is:2,not:2}}return this.mediaMatcherQuery?(e=this.mediaMatcherQuery.matches?c.is:c.not,e):c.is}clickSound(t){let e,c,s,a;e=window.AudioContext||window.webkitAudioContext,c=new e,c.createGain||(c.createGain=c.createGainNode),a=c.createGain(),a.gain.value=t,s=c.createBufferSource(),s.connect(a),this.game.clickSoundBuffer().then(t=>{c.decodeAudioData(t,t=>{s.buffer=t,a.connect(c.destination),s.start||(s.start=s.noteOn),s.start(0)},t=>{console.log(t)})})}mediaQueryListener(){return this.changeDetectorRef.markForCheck()}createMediaMatcher(){Object(s.t)(this.platformId)&&(this.mediaMatcherQuery=this.mediaMatcher.matchMedia("(min-aspect-ratio: 7/10)"),this.mediaMatcherQuery.addListener(this.mediaQueryListener.bind(this)))}checkForMatch(t){let e,c;if(e=t.reduce((t,e)=>(t.push(this.cards.deck[e]),t),[]),c=e.every((t,e,c)=>t.name===c[0].name),c?(Object(o.a)(100).pipe(Object(h.a)(1)).subscribe(()=>{(this.game.playing.value||this.cardsWon.length)&&(t.length===this.game.match.value&&(e.forEach(t=>{t.flipped=4}),Object(o.a)(600).pipe(Object(h.a)(1)).subscribe(()=>{(this.game.playing.value||this.cardsWon.length)&&(e.forEach(t=>{t.flipped=2}),this.changeDetectorRef.markForCheck())})),this.changeDetectorRef.markForCheck())}),t.length===this.game.match.value&&(this.cardsChosenId=[],this.cardsWon.push([...e.map(t=>t.name)]))):(Object(o.a)(100).pipe(Object(h.a)(1)).subscribe(()=>{this.game.playing.value&&(e.forEach(t=>{t.flipped=3}),Object(o.a)(600).pipe(Object(h.a)(1)).subscribe(()=>{this.game.playing.value&&(e.forEach(t=>{t.flipped=0}),this.clickSound(.25*this.effectsVolume),this.changeDetectorRef.markForCheck())}),this.changeDetectorRef.markForCheck())}),this.cardsChosenId=[]),this.cardsWon.length===this.game.count.value){let t;this.stopwatch.stop(),this.game.playing.next(!1),t=new k.a(this.game.mode.value,this.game.match.value,this.flips,this.game.count.value,this.stopwatch.milliseconds,this.stopwatch.seconds,this.stopwatch.minutes,this.stopwatch.hours,null,null,null,null),this.statistics.addStatistic(t),this.changeDetectorRef.markForCheck(),Object(o.a)(500).pipe(Object(h.a)(1)).subscribe(()=>{this.matDialog.open(v,{data:t,disableClose:!0}).afterClosed().subscribe(t=>{"reset"===t&&this.reset(new Event("click"))}),Object(o.a)(250).pipe(Object(h.a)(1)).subscribe(()=>{this.winReveal()})})}}updateFlipped(t){if(this.unFlipped.includes(t)){let e;e=this.unFlipped.indexOf(t),this.unFlipped.splice(e,1),this.unFlipped.sort(()=>.5-Math.random())}}flipCard(t,e){if(t.preventDefault(),this.game.playing.value||(this.game.playing.next(!0),this.stopwatch.restart()),!this.cards.deck[e].flipped&&!this.checking){if(this.flips++,this.cardsChosenId.push(e),this.cards.deck[e].flipped=1,this.updateFlipped(e),this.cardsChosenId.length>1){let t;this.checking=!0,t=[...this.cardsChosenId],Object(o.a)(250).pipe(Object(h.a)(1)).subscribe(()=>{this.game.playing.value&&this.checkForMatch(t),this.checking=!1})}this.clickSound(this.effectsVolume)}}winReveal(){this.game.playing.value||(this.cards.deck.forEach(t=>{t.flipped=1}),this.changeDetectorRef.markForCheck())}swapFirstMatch(t,e){if(this.cardsChosenId.length===this.game.match.value&&this.cards.deck[t].name===this.cards.deck[e].name&&this.unFlipped.includes(e)){let t,c,s;t=this.cards.deck[e],s=this.unFlipped.findIndex(e=>this.cards.deck[e].name!==t.name),-1!==s&&(c=this.cards.deck[this.unFlipped[s]],this.cards.deck[this.unFlipped[s]]=t,this.cards.deck[e]=c)}}ngOnInit(){this.createMediaMatcher(),this.reset(new Event("click")),Object(s.t)(this.platformId)?this.start(0):this.settings.settings||this.settings.settings.push(new j.a("match",2))}start(t){Object(C.a)(t)&&(t=0),t>100?console.error("Database took too long to initialise"):this.init().then(()=>{this.reset(new Event("click"))}).catch(e=>{window.requestAnimationFrame(()=>{this.start(++t)})})}init(){return new Promise((t,e)=>{this.settings.settings.length?t(void 0):e(void 0)})}reset(t){t.preventDefault(),this.cards.deck.forEach(t=>{t.flipped=0}),this.unFlipped=[...Array(this.cards.deck.length).keys()],this.unFlipped.sort(()=>.5-Math.random()),this.cardsChosenId=[],this.cardsWon=[],this.flips=0,this.cards.shuffle(),this.stopwatch.stop(),this.stopwatch.clear(),this.game.playing.next(!1),this.changeDetectorRef.markForCheck()}trackBy(t,e){return t}ngOnDestroy(){Object(s.t)(this.platformId)&&this.mediaMatcherQuery.removeListener(this.mediaQueryListener)}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(r.C),r.Lb(r.h),r.Lb(b.b),r.Lb(L.c),r.Lb(A),r.Lb(I.a),r.Lb(S.a),r.Lb(Q.a),r.Lb(x.a),r.Lb(i.e))},t.\u0275cmp=r.Fb({type:t,selectors:[["app-game"]],viewQuery:function(t,e){var c;1&t&&r.qc(R,!0),2&t&&r.kc(c=r.Zb())&&(e.stopwatch=c.first)},decls:20,vars:26,consts:[[1,"mat-elevation-z2"],["mat-flat-button","","color","warn","type","button",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","type","button",3,"click"],["class","mat-elevation-z2",4,"ngIf"],["mat-flat-button","","color","warn","type","button",3,"click"],["rowHeight","1:1","gutterSize","10px",3,"cols"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"card-wrapper",3,"click"],[1,"card-holder","mat-elevation-z4",3,"ngClass"],[1,"card-action"],[1,"card-blank"]],template:function(t,e){1&t&&(r.Rb(0,"mat-card",0),r.Rb(1,"mat-card-title-group"),r.Rb(2,"mat-card-title"),r.vc(3),r.bc(4,"translate"),r.bc(5,"number"),r.bc(6,"number"),r.uc(7,E,3,3,"button",1),r.Qb(),r.Rb(8,"mat-card-title"),r.vc(9),r.bc(10,"translate"),r.bc(11,"number"),r.Qb(),r.Rb(12,"mat-card-title"),r.Mb(13,"app-stopwatch"),r.Qb(),r.Qb(),r.Rb(14,"mat-card-title-group"),r.Rb(15,"mat-card-subtitle"),r.Rb(16,"button",2),r.Yb("click",(function(t){return e.reset(t)})),r.vc(17),r.bc(18,"translate"),r.Qb(),r.Qb(),r.Qb(),r.Qb(),r.uc(19,Y,4,3,"mat-card",3)),2&t&&(r.Ab(3),r.zc(" ",r.cc(4,8,"MATCHES"),": ",r.dc(5,10,e.cardsWon.length,"1.0",e.translate.currentLang)," / ",r.dc(6,14,e.game.count.value,"1.0",e.translate.currentLang)," "),r.Ab(4),r.gc("ngIf",!e.profiler.environment),r.Ab(2),r.yc(" ",r.cc(10,18,"FLIPS"),": ",r.dc(11,20,e.flips,"1.0",e.translate.currentLang)," "),r.Ab(8),r.xc(" ",r.cc(18,24,"RESET")," "),r.Ab(2),r.gc("ngIf",e.settings.settings.length))},directives:[D.a,D.f,D.e,s.l,R,D.d,u.b,D.b,P.a,s.k,P.c,s.j],pipes:[i.d,s.e],styles:['mat-card[_ngcontent-%COMP%]:first-of-type{margin-bottom:16px}mat-card-content[_ngcontent-%COMP%]{max-width:calc(100vh - 40px - env(safe-area-inset-bottom) - env(safe-area-inset-top));margin:auto}mat-grid-tile[_ngcontent-%COMP%]{overflow:visible}.card-holder[_ngcontent-%COMP%], img[_ngcontent-%COMP%]{position:absolute;top:0;right:0;bottom:0;left:0}.card-wrapper[_ngcontent-%COMP%]{position:absolute;top:4%;right:4%;bottom:4%;left:4%;perspective-origin:50%;perspective:800px}.card-holder[_ngcontent-%COMP%]{will-change:transform;transform-style:preserve-3d;border-radius:12px;transition:transform .25s}.card-holder[_ngcontent-%COMP%]:before{content:"";z-index:2;border-radius:17px;will-change:border;position:absolute;top:-6px;right:-6px;bottom:-6px;left:-6px;transition:border .25s;border:0 solid transparent;transform:rotateY(-180deg)}.card-holder.f-3-t-0[_ngcontent-%COMP%]:before{border:4px solid red}.card-holder.f-4-t-0[_ngcontent-%COMP%]:before{border:4px solid green}.card-action[_ngcontent-%COMP%]{transform:rotateY(-180deg)}.card-blank[_ngcontent-%COMP%], .card-holder[_ngcontent-%COMP%]{transform:rotateY(0deg)}img[_ngcontent-%COMP%]{width:100%;height:100%;-webkit-backface-visibility:hidden;backface-visibility:hidden;opacity:.99999;border-radius:12px}'],data:{animation:[d]},changeDetection:0}),t})();const W=[{component:V,path:""}];let G=(()=>{class t{}return t.\u0275mod=r.Jb({type:t}),t.\u0275inj=r.Ib({factory:function(e){return new(e||t)},imports:[[a.d.forChild(W)],a.d]}),t})();var H=c("tLcC"),z=c("jyP3"),U=c("YbVE");let q=(()=>{class t{constructor(t,e){t.lang.subscribe(t=>{let c;c=e.use(t).subscribe(()=>{},()=>{console.error(`Language "${t}": at "GameModule" not found.`),e.setTranslation(t,{},!0)},()=>{c&&c instanceof n.a&&c.unsubscribe()})})}}return t.\u0275mod=r.Jb({type:t,bootstrap:[V]}),t.\u0275inj=r.Ib({factory:function(e){return new(e||t)(r.Vb(U.a),r.Vb(i.e))},providers:[{provide:z.a,useValue:"game"}],imports:[[s.c,G,H.a,a.d,i.c.forChild(z.b)]]}),t})()}}]);
//# sourceMappingURL=game-game-module.05ee9957f531e1608778.js.map